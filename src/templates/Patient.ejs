<%# Patient Template %>
<%# Based on http://hl7.org/fhir/us/mcode/StructureDefinition-mcode-cancer-patient.html %>
<%# Official url: http://hl7.org/fhir/us/mcode/StructureDefinition/obf-Patient %>
<% /* %>
{
  id: String,
  mrn: String,
  family: String,
  given: String,
  gender: String,
  dateOfBirth: String,
  language: String,
  address: String,
  city: String,
  state: String,
  zip: String,
  raceCodesystem: String,
  raceCode: String,
  raceText: String,
  ethnicityCode: String,
  ethnicityText: String,
}
<% */ %>
{
  "resourceType": "Patient",
  "id": "<%- id %>",
  "identifier": [
      {
          "type" : {
              "coding" : [
                {
                  "system" : "http://terminology.hl7.org/CodeSystem/v2-0203",
                  "code" : "MR",
                  "display" : "Medical Record Number"
                }
              ],
              "text" : "Medical Record Number"
          },
          "system": "http://example.com/system/mrn",
          "value": "<%- mrn %>"
      }
  ],
  "name": [
      {
          "text": "<%- `${given} ${family}` %>",
          "family": "<%- family %>",
          "given": [ <%- given.split(' ').map(e => `"${e}"`) %> ]
      }
  ],
  "gender": "<%- gender %>"<% if(locals.dateOfBirth && dateOfBirth) { %>,
  "birthDate": "<%- dateOfBirth%>"<% } %><% if (locals.address && address && locals.city && city && locals.state && state && locals.zip && zip) { %>,
  "address": [
    {
      "line": [
        "<%- address %>"
      ],
      "city": "<%- city %>",
      "state": "<%- state %>",
      "postalCode": "<%- zip %>",
      "country": "US"
    }
  ]<% } %><% if (locals.language && language) { %>,
  "communication": [
    {
      "language": {
        "coding": [
          {
            "system": "urn:ietf:bcp:47",
            "code": "<%- language %>"
          }
        ]
      }
    }
  ]<% } %><% if ((locals.raceCodesystem && locals.raceCode && locals.raceText && raceCodesystem && raceCode && raceText) || (locals.ethnicityCode && locals.ethnicityText && ethnicityCode && ethnicityText)) { %>,
  "extension": [
    <% if (locals.raceCodesystem && locals.raceCode && locals.raceText && raceCodesystem && raceCode && raceText) { %> {
      "extension": [
        {
          "url": "ombCategory",
          "valueCoding": {
            "system": "<%- raceCodesystem %>",
            "code": "<%- raceCode %>"
          }
        },
        {
          "url": "text",
          "valueString": "<%- raceText %>"
        }
      ],
      "url": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"
    }<% } %><% if ((locals.raceCodesystem && locals.raceCode && locals.raceText && raceCodesystem && raceCode && raceText) && (locals.ethnicityCode && locals.ethnicityText && ethnicityCode && ethnicityText)) { %>,<% } %>
    <% if (locals.ethnicityCode && locals.ethnicityText && ethnicityCode && ethnicityText) { %> {
      "extension": [
        {
          "url": "ombCategory",
          "valueCoding": {
            "system": "urn:oid:2.16.840.1.113883.6.238",
            "code": "<%- ethnicityCode %>"
          }
        },
        {
          "url": "text",
          "valueString": "<%- ethnicityText %>"
        }
      ],
      "url": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity"
    }<% } %>
  ]<% } %>
}

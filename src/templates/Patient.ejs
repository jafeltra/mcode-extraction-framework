<%# Patient Template %>
<%# Based on http://hl7.org/fhir/us/mcode/StructureDefinition-mcode-cancer-patient.html %>
<%# Official url: http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-cancer-patient %>
<% /* %>
{
  id: String,
  mrn: String,
  familyName: String,
  givenName: String,
  gender: String,
  birthSex: String,
  dateOfBirth: String,
  language: String,
  addressLine: String,
  city: String,
  state: String,
  zip: String,
  raceCodesystem: String,
  raceCode: String,
  raceText: String,
  ethnicityCode: String,
  ethnicityText: String,
}
<% */ %>
{
  "resourceType": "Patient",
  "id": "<%- id %>",
  "identifier": [
      {
          "type" : {
              "coding" : [
                {
                  "system" : "http://terminology.hl7.org/CodeSystem/v2-0203",
                  "code" : "MR",
                  "display" : "Medical Record Number"
                }
              ],
              "text" : "Medical Record Number"
          },
          "system": "http://example.com/system/mrn",
          "value": "<%- mrn %>"
      }
  ],
  "name": [
      {
          "text": "<%- `${givenName} ${familyName}` %>",
          "family": "<%- familyName %>",
          "given": [ <%- givenName.split(' ').map(e => `"${e}"`) %> ]
      }
  ],
  "gender": "<%- gender %>"<% if(locals.dateOfBirth && dateOfBirth) { %>,
  "birthDate": "<%- dateOfBirth%>"<% } %><% if (locals.addressLine || locals.city || locals.state || locals.zip) { %>,
  "address": [
    {
      <% if (locals.addressLine && addressLine) { %>"line": [
        "<%- addressLine %>"
      ],<% } %>
      <% if (locals.city && city) { %>"city": "<%- city %>",<% } %>
      <% if (locals.state && state) { %>"state": "<%- state %>",<% } %>
      <% if (locals.zip && zip) { %>"postalCode": "<%- zip %>",<% } %>
      "country": "US"
    }
  ]<% } %><% if (locals.language && language) { %>,
  "communication": [
    {
      "language": {
        "coding": [
          {
            "system": "urn:ietf:bcp:47",
            "code": "<%- language %>"
          }
        ]
      }
    }
  ]<% } %><% if ((locals.raceCodesystem && locals.raceCode && locals.raceText && raceCodesystem && raceCode && raceText) || (locals.ethnicityCode && locals.ethnicityText && ethnicityCode && ethnicityText) || (locals.birthSex && birthSex)) { %>,
  "extension": [
    <% if (locals.raceCodesystem && locals.raceCode && locals.raceText && raceCodesystem && raceCode && raceText) { %> {
      "extension": [
        {
          "url": "ombCategory",
          "valueCoding": {
            "system": "<%- raceCodesystem %>",
            "code": "<%- raceCode %>"
          }
        },
        {
          "url": "text",
          "valueString": "<%- raceText %>"
        }
      ],
      "url": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"
    }<% if ((locals.ethnicityCode && locals.ethnicityText && ethnicityCode && ethnicityText) || (locals.birthSex && birthSex)) { %>,<% } %><% } %>
    <% if (locals.ethnicityCode && locals.ethnicityText && ethnicityCode && ethnicityText) { %> {
      "extension": [
        {
          "url": "ombCategory",
          "valueCoding": {
            "system": "urn:oid:2.16.840.1.113883.6.238",
            "code": "<%- ethnicityCode %>"
          }
        },
        {
          "url": "text",
          "valueString": "<%- ethnicityText %>"
        }
      ],
      "url": "http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity"
    }<% if (locals.birthSex && birthSex) { %>,<% } %><% } %>
    <% if (locals.birthSex && birthSex) { %> {
      "url" : "http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex",
      "valueCode" : "<%- birthSex %>"
    }<% } %>
  ]<% } %>
}

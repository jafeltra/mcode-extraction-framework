<%# Based on http://hl7.org/fhir/us/mcode/StructureDefinition-mcode-cancer-disease-status %>
<% /* %>
{
  id: String,
  status: String,
  effectiveDateTime: DateTime,
  condition: {
    id: String,
    name: String,
  },
  subject: {
    id: String,
    name: String,
  },
  value: {
    system: String,
    code: String,
    display: String,
  },
  evidence: [{
    code: String,
    display: String,
  }]
}
<% */ %>
{
  "resourceType": "Observation",
  "id": "<%- id %>",
  "meta": {
    "profile": [
      "http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-cancer-disease-status"
    ]
  },
  "category": [
    {
      "coding": [
        {
          "system": "http://terminology.hl7.org/CodeSystem/observation-category",
          "code": "therapy",
          "display": "Therapy"
        }
      ]
    }
  ],
  "status": "<%- status %>",
  "code": {
    "coding": [
      {
          "system": "http://loinc.org",
          "code": "88040-1",
          "display": "Response to cancer treatment"
      }
    ]
  },
  "focus" : [
    {
      "reference": "urn:uuid:<%- condition.id %>"<% if (condition.name) { %>,
      "display": "<%- condition.name %>"
      <% } %>
    }
  ],
  "subject" : {
    "reference": "urn:uuid:<%- subject.id %>"<% if (subject.name) { %>,
    "display": "<%- subject.name %>"
    <% } %>
  },
  "effectiveDateTime" : "<%- effectiveDateTime %>",
  "valueCodeableConcept": {
    "coding": [
      {
        "system": "<%- value.system %>",
        "code": "<%- value.code %>",
        "display": "<%- value.display %>"
      }
    ]
  }<% if (evidence) { %>,
  "extension" : [
    <% evidence.forEach(e => { %>
    {
      "url" : "http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-evidence-type",
      "valueCodeableConcept" : {
        "coding" : [
          {
            "system" : "http://snomed.info/sct",
            "display": <%- e.display %>
            "code" : <%- e.code %>
          }
        ]
      }
    }<% }) %>
  ]<% } %>
}

